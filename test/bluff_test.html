<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Test suite for "Bluff it"</title>
  	<script src="http://js.local/jquery/jquery-1.2.6.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="http://js.local/qunit/qunit.css" type="text/css" media="screen" />
    <script type="text/javascript" src="http://js.local/qunit/qunit.js"></script>
    <script type="text/javascript" src="http://js.local/bluff/number.js"></script>
    <script type="text/javascript" src="http://js.local/bluff/object.js"></script>
    <script type="application/javascript">
      var dice = {
        roll : function() {
          return 1;
        }
      }

      var roll = {
        ROLLS : ["32", "41", "42", "43", "51", "52", "53", "54", "61", "62", "63", "64", "65",
                 "11", "22", "33", "44", "55", "66", "21"],
        isValid : function(r) {
          return this.ROLLS.indexOf(r) != -1;
        }
      }

      var player = {
        rollTheDice : function() {
          return "21"
        },
      }

      $(document).ready(function(){
        test("dice.roll", function() {
          // Check that in a series of 5 dice rolls, none is outside the (1..6) range
          // Can this be made in a simpler way?
          var invalidRolls = $.grep((1).upto(5), function(_, i){
            var r = dice.roll();
            return r >= 1 && r <= 6;
          }, true)
          ok( invalidRolls.length == 0, "roll is a number between 1 and 6")
        });

        test("roll.isValid", function(){
          equal( roll.isValid("32"), true, "32 is a valid roll");
          equal( roll.isValid("23"), false, "23 is not a valid roll, the bigger number has to be put first");
        });

        test("player.rollTheDice", function() {
          var validDiceRolls = $.grep((1).upto(5), function(_, i){
            var r = player.rollTheDice();
            return roll.isValid(r)
          })
          equal(validDiceRolls.length, 5, "a dice roll is between 32 and 21")
        })

        test("winning when bluff unduly called", function(){
          var playerOne = Object.create(player);
          var playerTwo = Object.create(player);
          game.setHighestRoll("43");
          playerOne.setCurrentRoll("22");
          playerOne.annonce("22");
          playerTwo.callBluff();
          ok( playerOne.hasWon(), "player wins if opponent says he bluffed but he did not");
          // ok( player.youBluffed(), "player wins if says opponent has bluffed and the opponent did")
        });

        test("winning when bluff is found out", function(){
          var playerOne = Object.create(player);
          var playerTwo = Object.create(player);
          game.setHighestRoll("43");
          playerOne.setCurrentRoll("41");
          playerOne.annonce("22");
          playerTwo.callBluff();
          ok( player.youBluffed(), "player wins if says opponent has bluffed and the opponent did")
        })

      })
    </script>
  </head>
  <body>
    <h1 id="qunit-header">Bluff it</h1>
   <h2 id="qunit-banner"></h2>
   <h2 id="qunit-userAgent"></h2>
   <ol id="qunit-tests"></ol>
  </body>
</html>
